import{r as h,j as o}from"./jsx-runtime-56DGgGmo.js";const T=h.createContext(void 0),_=({children:n})=>{const[d,v]=h.useState([]),[y,u]=h.useState(null),f=h.useCallback(g=>{u(e=>e===g?null:g)},[]);return o.jsx(T.Provider,{value:{palette:d,selectedColor:y,setPalette:v,setSelectedColor:u,handleColorSelection:f},children:n})},Y=()=>{const n=h.useContext(T);if(n===void 0)throw new Error("usePalette must be used within a PaletteProvider");return n};function z(n,d,v){return"#"+((1<<24)+(n<<16)+(d<<8)+v).toString(16).slice(1)}const G=800,W=4,O=20,X=16,B=4096,F=10;function U(n,d=5,v=[0,0,0],y=[0,0],u=.125){const f=document.createElement("canvas"),g=f.getContext("2d",{willReadFrequently:!0});if(!g)return{palette:[],markers:[]};const e=Math.min(1,G/Math.max(n.width,n.height));f.width=n.width*e,f.height=n.height*e,g.drawImage(n,0,0,f.width,f.height);const t=g.getImageData(0,0,f.width,f.height).data,i=q(t,d,v),{palette:r,markers:x}=K(t,i,d,u,e,y,f);return{palette:r,markers:x}}function q(n,d,v){const y=Array(B).fill(null).map(()=>[]);for(let e=0;e<n.length;e+=W){const a=n[e],t=n[e+1],i=n[e+2],r=Math.floor(a/X)*256+Math.floor(t/X)*16+Math.floor(i/X);y[r].push([a,t,i])}const u=y.filter(e=>e.length>=F),f=u.length,g=[v];for(;g.length<d;){let e=-1,a=null;for(let t=0;t<f;t++){if(u[t].length===0)continue;const i=u[t].reduce((c,I)=>[c[0]+I[0],c[1]+I[1],c[2]+I[2]]).map(c=>Math.round(c/u[t].length)),x=Math.min(...g.map(c=>H(i,c)))*Math.sqrt(u[t].length);x>e&&(e=x,a=i)}if(a)g.push(a);else break}return g}function K(n,d,v,y,u,f,g){let e=d,a=0,t=1/0;for(;a<O;){const x=Array(v).fill(null).map(()=>[]);let c=0,I=0;for(let w=0;w<n.length;w+=W){if(Math.random()>y)continue;const p=[n[w],n[w+1],n[w+2]];let m=0,C=1/0;for(let M=0;M<e.length;M++){const P=H(p,e[M]);P<C&&(C=P,m=M)}x[m].push(p),c+=C,I++}if(c/=I,c>=t)break;t=c,e=x.map(w=>w.length>0?w.reduce((p,m)=>[p[0]+m[0],p[1]+m[1],p[2]+m[2]]).map(p=>Math.round(p/w.length)):e[x.indexOf(w)]),a++}const i=e.map(x=>z(x[0],x[1],x[2])),r=e.map((x,c)=>{if(c===0)return{x:f[0],y:f[1],color:i[0]};{let I=1/0,w=0,p=0;for(let m=0;m<g.height;m++)for(let C=0;C<g.width;C++){const M=(m*g.width+C)*W,P=[n[M],n[M+1],n[M+2]],E=H(P,x);E<I&&(I=E,w=C,p=m)}return{x:w/u,y:p/u,color:i[c]}}});return{palette:i,markers:r}}function H(n,d){return Math.sqrt(Math.pow(n[0]-d[0],2)+Math.pow(n[1]-d[1],2)+Math.pow(n[2]-d[2],2))}function Z({imageSrc:n}){const d=h.useRef(null),[v,y]=h.useState(!1),{selectedColor:u,setSelectedColor:f,setPalette:g}=Y(),[e,a]=h.useState(null),[t,i]=h.useState([]),[r,x]=h.useState({width:0,height:0}),c=h.useMemo(()=>window.devicePixelRatio||1,[]),I=h.useCallback(()=>{const s=d.current;s&&x({width:s.clientWidth,height:s.clientHeight})},[]);h.useEffect(()=>(I(),window.addEventListener("resize",I),()=>window.removeEventListener("resize",I)),[I]);const w=h.useCallback((s,l,j)=>{const b=document.createElement("canvas");b.width=s.width,b.height=s.height;const k=b.getContext("2d");if(!k)return;k.drawImage(s,0,0,s.width,s.height);const S=k.getImageData(l,j,1,1).data,D=[S[0],S[1],S[2]],R=[l,j],{palette:N,markers:A}=U(s,5,D,R);g(N),i(A),f(N[0])},[g,f]);h.useEffect(()=>{if(n){const s=new Image;s.onload=()=>{a(s);const l=Math.floor(Math.random()*s.width),j=Math.floor(Math.random()*s.height);w(s,l,j)},s.src=n}},[n,w]);const{drawWidth:p,drawHeight:m,offsetX:C,offsetY:M}=h.useMemo(()=>{if(!e||!r.width||!r.height)return{drawWidth:0,drawHeight:0,offsetX:0,offsetY:0};const s=e.width/e.height,l=r.width/r.height;let j,b,k,S;return s>l?(j=r.width,b=r.width/s,k=0,S=(r.height-b)/2):(b=r.height,j=r.height*s,k=(r.width-j)/2,S=0),{drawWidth:j,drawHeight:b,offsetX:k,offsetY:S}},[e,r]),P=h.useCallback(()=>{const s=d.current,l=s==null?void 0:s.getContext("2d");if(!s||!l||!e)return;s.width=r.width*c,s.height=r.height*c,s.style.width=`${r.width}px`,s.style.height=`${r.height}px`,l.scale(c,c),l.drawImage(e,C,M,p,m);const j=10;l.save(),t.forEach(b=>{const k=b.x/e.width*p+C,S=b.y/e.height*m+M;l.beginPath(),l.arc(k,S,j,0,2*Math.PI),l.fillStyle=b.color,l.fill(),l.strokeStyle=b.color===u?"black":"white",l.lineWidth=b.color===u?3:2,l.stroke(),b.color===u&&(l.beginPath(),l.arc(k,S,j+5,0,2*Math.PI),l.strokeStyle="white",l.lineWidth=2,l.stroke())}),l.restore()},[e,t,u,c,r,p,m,C,M]);h.useEffect(()=>{P()},[P]);const E=h.useCallback((s,l)=>{const j=d.current;if(!j||!e)return;const b=j.getBoundingClientRect(),k=s.clientX-b.left,S=s.clientY-b.top,D=Math.round((k-C)/p*e.width),R=Math.round((S-M)/m*e.height),N=t.find(A=>{const $=A.x/e.width*p+C,L=A.y/e.height*m+M;return Math.hypot(k-$,S-L)<=10});l?N?f(N.color):w(e,D,R):y(!!N)},[t,e,f,p,m,C,M,w]);return o.jsx("canvas",{ref:d,className:`w-full h-full ${v?"cursor-pointer":""}`,onClick:s=>E(s,!0),onMouseMove:s=>E(s,!1)})}function J(){const[n,d]=h.useState(null),v=h.useRef(null),y=h.useCallback(e=>{const a=new FileReader;a.onload=t=>{var r;const i=(r=t.target)==null?void 0:r.result;d(i)},a.readAsDataURL(e)},[]),u=h.useCallback(e=>{e.preventDefault();const a=e.dataTransfer.files[0];a&&a.type.startsWith("image/")&&y(a)},[y]),f=h.useCallback(e=>{e.preventDefault()},[]),g=h.useCallback(()=>{var e;(e=v.current)==null||e.click()},[]);return o.jsx("section",{className:"h-1/2 border-b border-gray-700 flex flex-col",onDrop:u,onDragOver:f,children:o.jsx("div",{className:"flex-grow flex items-center justify-center overflow-hidden relative",children:n?o.jsx(Z,{imageSrc:n}):o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-gray-400 mb-2",children:"Drag and drop an image here or click to upload"}),o.jsx("input",{ref:v,type:"file",accept:"image/*",onChange:e=>{var t;const a=(t=e.target.files)==null?void 0:t[0];a&&y(a)},className:"hidden"}),o.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded",onClick:g,children:"Select Image"})]})})})}const Q=()=>{const{palette:n,selectedColor:d,handleColorSelection:v}=Y(),y=e=>{const a=parseInt(e.slice(1,3),16),t=parseInt(e.slice(3,5),16),i=parseInt(e.slice(5,7),16);return`rgb(${a}, ${t}, ${i})`},u=e=>{const a=255-parseInt(e.slice(1,3),16),t=255-parseInt(e.slice(3,5),16),i=255-parseInt(e.slice(5,7),16);return`#${a.toString(16).padStart(2,"0")}${t.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}`},f=(e,a)=>{const t=x=>{const c=parseInt(x.slice(1),16),I=c>>16&255,w=c>>8&255,p=c>>0&255,m=[I,w,p].map(C=>(C/=255,C<=.03928?C/12.92:Math.pow((C+.055)/1.055,2.4)));return .2126*m[0]+.7152*m[1]+.0722*m[2]},i=t(e),r=t(a);return(Math.max(i,r)+.05)/(Math.min(i,r)+.05)},g=e=>e>=7?"AAA":e>=4.5?"AA":e>=3?"AA Large":"Fail";return o.jsx("section",{className:"h-1/2",children:o.jsx("div",{className:"flex h-full",children:n.sort((e,a)=>e.localeCompare(a)).map((e,a)=>{const t=u(e),i=f(e,t),r=g(i);return o.jsxs("div",{className:"flex-1 flex flex-col",style:{borderColor:e===d?"white":e},children:[o.jsxs("div",{role:"button",tabIndex:0,className:"flex-grow flex flex-col justify-between p-4 cursor-pointer border-4",style:{backgroundColor:e,borderColor:e===d?"white":e},onClick:()=>v(e),onKeyDown:x=>{(x.key==="Enter"||x.key===" ")&&v(e)},children:[o.jsxs("div",{className:"text-xs",style:{color:t},children:[o.jsx("div",{children:e}),o.jsx("div",{children:y(e)})]}),o.jsxs("div",{className:"text-center text-3xl",children:[o.jsx("div",{className:"font-bold",style:{color:t},children:"Aa"}),o.jsx("div",{style:{color:t},children:"Aa"})]}),o.jsxs("div",{className:"text-xs",style:{color:t},children:[o.jsxs("div",{children:["Contrast: ",i.toFixed(2)]}),o.jsxs("div",{children:["WCAG: ",r]})]})]}),o.jsxs("div",{className:"h-1/4 p-2 text-xs flex items-center justify-center",style:{backgroundColor:t,color:e},children:["Complementary: ",t]})]},a)})})})},ee=()=>[{title:"Palette Generator"},{name:"description",content:"Generate a palette from an image using k-means clustering"}];function te(){return o.jsx(_,{children:o.jsxs("div",{className:"font-sans h-screen flex flex-col bg-gray-900 text-gray-200",children:[o.jsx("header",{className:"bg-gray-800 p-4",children:o.jsx("h1",{className:"text-2xl font-bold",children:"Palette Generator"})}),o.jsxs("main",{className:"flex-grow flex flex-col",children:[o.jsx(J,{}),o.jsx(Q,{})]})]})})}export{te as default,ee as meta};
